<!DOCTYPE html>
<html>
<head>
    <title>FCM Token Test - Baro Push Notification</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-messaging-compat.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #007bff; }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .success { border-left-color: #28a745; background: #d4edda; }
        textarea { width: 100%; height: 100px; margin: 10px 0; }
        .step { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¥ FCM Token Test - Baro Push Notification</h1>
        
        <div class="step">
            <h3>1. Firebase ì„¤ì •</h3>
            <p>Firebase Consoleì—ì„œ í”„ë¡œì íŠ¸ ì„¤ì •ì„ ê°€ì ¸ì™€ì„œ ì•„ë˜ì— ì…ë ¥í•˜ì„¸ìš”:</p>
            <input type="text" id="apiKey" placeholder="API Key" style="width: 100%; margin: 5px 0;">
            <input type="text" id="authDomain" placeholder="Auth Domain (ì˜ˆ: baroyofi.firebaseapp.com)" style="width: 100%; margin: 5px 0;">
            <input type="text" id="projectId" placeholder="Project ID (ì˜ˆ: baroyofi)" style="width: 100%; margin: 5px 0;">
            <input type="text" id="storageBucket" placeholder="Storage Bucket (ì˜ˆ: baroyofi.appspot.com)" style="width: 100%; margin: 5px 0;">
            <input type="text" id="messagingSenderId" placeholder="Messaging Sender ID" style="width: 100%; margin: 5px 0;">
            <input type="text" id="appId" placeholder="App ID" style="width: 100%; margin: 5px 0;">
            <input type="text" id="vapidKey" placeholder="VAPID Key (ì„ íƒì‚¬í•­)" style="width: 100%; margin: 5px 0;">
            <button onclick="initializeFirebase()">Firebase ì´ˆê¸°í™”</button>
        </div>

        <div class="step">
            <h3>2. ê¶Œí•œ ìš”ì²­</h3>
            <button onclick="requestPermission()">ì•Œë¦¼ ê¶Œí•œ ìš”ì²­</button>
            <div id="permissionStatus"></div>
        </div>

        <div class="step">
            <h3>3. FCM í† í° ë°œê¸‰</h3>
            <button onclick="getToken()">FCM í† í° ë°œê¸‰</button>
            <div id="tokenResult"></div>
        </div>

        <div class="step">
            <h3>4. ë©”ì‹œì§€ ìˆ˜ì‹  í…ŒìŠ¤íŠ¸</h3>
            <p>í‘¸ì‹œ ì•Œë¦¼ì„ ë°›ìœ¼ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤:</p>
            <div id="messageResult"></div>
        </div>

        <div class="step">
            <h3>5. Postman ì„¤ì •</h3>
            <p>ë°œê¸‰ë°›ì€ FCM í† í°ì„ Postman í™˜ê²½ë³€ìˆ˜ì— ì„¤ì •í•˜ì„¸ìš”:</p>
            <ul>
                <li><strong>fcm_token</strong>: ìœ„ì—ì„œ ë°œê¸‰ë°›ì€ í† í°</li>
                <li><strong>firebase_server_key</strong>: Firebase Console > í”„ë¡œì íŠ¸ ì„¤ì • > í´ë¼ìš°ë“œ ë©”ì‹œì§• > ì„œë²„ í‚¤</li>
            </ul>
        </div>
    </div>

    <script>
        let messaging = null;

        function initializeFirebase() {
            try {
                const apiKey = document.getElementById('apiKey').value;
                const authDomain = document.getElementById('authDomain').value;
                const projectId = document.getElementById('projectId').value;
                const storageBucket = document.getElementById('storageBucket').value;
                const messagingSenderId = document.getElementById('messagingSenderId').value;
                const appId = document.getElementById('appId').value;

                if (!apiKey || !authDomain || !projectId) {
                    showError('API Key, Auth Domain, Project IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
                    return;
                }

                const firebaseConfig = {
                    apiKey: apiKey,
                    authDomain: authDomain,
                    projectId: projectId,
                    storageBucket: storageBucket,
                    messagingSenderId: messagingSenderId,
                    appId: appId
                };

                firebase.initializeApp(firebaseConfig);
                messaging = firebase.messaging();
                
                showSuccess('Firebase ì´ˆê¸°í™” ì„±ê³µ!');
            } catch (error) {
                showError('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨: ' + error.message);
            }
        }

        async function requestPermission() {
            try {
                const permission = await Notification.requestPermission();
                const statusDiv = document.getElementById('permissionStatus');
                
                if (permission === 'granted') {
                    statusDiv.innerHTML = '<div class="result success">âœ… ì•Œë¦¼ ê¶Œí•œì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
                } else {
                    statusDiv.innerHTML = '<div class="result error">âŒ ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ í—ˆìš©í•´ì£¼ì„¸ìš”.</div>';
                }
            } catch (error) {
                showError('ê¶Œí•œ ìš”ì²­ ì‹¤íŒ¨: ' + error.message);
            }
        }

        async function getToken() {
            try {
                if (!messaging) {
                    showError('ë¨¼ì € Firebaseë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.');
                    return;
                }

                const vapidKey = document.getElementById('vapidKey').value;
                const tokenOptions = vapidKey ? { vapidKey: vapidKey } : {};
                
                const token = await messaging.getToken(tokenOptions);
                const tokenDiv = document.getElementById('tokenResult');
                
                tokenDiv.innerHTML = `
                    <div class="result success">
                        <h4>âœ… FCM í† í° ë°œê¸‰ ì„±ê³µ!</h4>
                        <p>ì•„ë˜ í† í°ì„ ë³µì‚¬í•´ì„œ Postmanì— ì…ë ¥í•˜ì„¸ìš”:</p>
                        <textarea readonly>${token}</textarea>
                        <button onclick="copyToken('${token}')">í† í° ë³µì‚¬</button>
                    </div>
                `;

                // ë©”ì‹œì§€ ìˆ˜ì‹  ë¦¬ìŠ¤ë„ˆ ì„¤ì •
                messaging.onMessage((payload) => {
                    const messageDiv = document.getElementById('messageResult');
                    messageDiv.innerHTML = `
                        <div class="result success">
                            <h4>ğŸ“± í‘¸ì‹œ ì•Œë¦¼ ìˆ˜ì‹ !</h4>
                            <p><strong>ì œëª©:</strong> ${payload.notification.title}</p>
                            <p><strong>ë‚´ìš©:</strong> ${payload.notification.body}</p>
                            <p><strong>ë°ì´í„°:</strong> ${JSON.stringify(payload.data, null, 2)}</p>
                        </div>
                    `;
                });

            } catch (error) {
                showError('í† í° ë°œê¸‰ ì‹¤íŒ¨: ' + error.message);
            }
        }

        function copyToken(token) {
            navigator.clipboard.writeText(token).then(() => {
                alert('í† í°ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                alert('ë³µì‚¬ ì‹¤íŒ¨. ìˆ˜ë™ìœ¼ë¡œ ë³µì‚¬í•´ì£¼ì„¸ìš”.');
            });
        }

        function showSuccess(message) {
            console.log('âœ… ' + message);
        }

        function showError(message) {
            console.error('âŒ ' + message);
        }
    </script>
</body>
</html>
